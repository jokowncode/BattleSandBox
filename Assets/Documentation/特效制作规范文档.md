# 特效制作规范文档

## 基于 Bullet.cs 的特效系统制作规范

### 版本信息
- **文档版本**: 1.0
- **创建日期**: 2024年
- **适用代码**: Bullet.cs
- **适用范围**: 投射物类特效

---

## 目录
1. [系统概述](#系统概述)
2. [预制体结构规范](#预制体结构规范)
3. [特效资源制作规范](#特效资源制作规范)
4. [代码配置要求](#代码配置要求)
5. [性能优化规范](#性能优化规范)
6. [命名规范](#命名规范)
7. [测试验证清单](#测试验证清单)

---

## 系统概述

### 特效系统架构
```
Bullet.cs 特效系统
├── 发射阶段 (Start)
│   ├── 闪光特效 (Flash)
│   └── 自动销毁设置
├── 飞行阶段 (FixedUpdate)
│   ├── 移动控制
│   └── 尾迹特效
├── 碰撞阶段 (OnCollisionEnter)
│   ├── 爆炸特效 (Hit)
│   ├── 分离特效 (Detached)
│   └── 伤害计算
└── 清理阶段
    └── 自动销毁
```

### 核心逻辑流程
1. **实例化** → 获取Rigidbody组件
2. **发射** → 播放闪光特效，设置2秒自动销毁
3. **飞行** → 根据MoveVector持续移动
4. **碰撞** → 检测目标层级，播放爆炸特效
5. **伤害** → 传递EffectData给目标
6. **清理** → 分离特效，销毁子弹

---

## 预制体结构规范

### 子弹预制体结构
```
Bullet_Prefab
├── Bullet.cs (脚本组件)
├── Rigidbody (物理组件)
├── Collider (碰撞组件)
├── Mesh Renderer (可选，子弹模型)
├── Trail Renderer (可选，尾迹)
└── 子对象
    ├── Bullet_Mesh (子弹模型)
    ├── Bullet_Trail (尾迹特效)
    ├── Bullet_Particles (飞行粒子)
    └── Bullet_Collider (碰撞体)
```

### 特效预制体结构
```
特效预制体
├── ParticleSystem (主粒子系统)
├── AudioSource (音效组件，可选)
├── Light (光源组件，可选)
└── 子对象
    ├── Sub_ParticleSystem (子粒子系统)
    ├── Sub_AudioSource (子音效)
    └── Sub_Light (子光源)
```

---

## 特效资源制作规范

### 1. 发射闪光特效 (Flash)
```
Flash_Effect 设置规范：
├── ParticleSystem
│   ├── Duration: 0.1-0.3秒
│   ├── Start Lifetime: 0.1-0.2秒
│   ├── Start Speed: 5-10
│   ├── Start Size: 0.1-0.5
│   ├── Shape: Sphere/Cone
│   ├── Emission Rate: 50-100
│   ├── Color: 白色/黄色
│   └── Auto Destroy: 开启
├── AudioSource (可选)
│   ├── AudioClip: 发射音效
│   ├── Volume: 0.3-0.7
│   └── Spatial Blend: 3D
└── Light (可选)
    ├── Type: Point
    ├── Range: 2-5
    └── Intensity: 1-3
```

### 2. 碰撞爆炸特效 (Hit)
```
Hit_Effect 设置规范：
├── ParticleSystem (主爆炸)
│   ├── Duration: 0.5-2.0秒
│   ├── Start Lifetime: 0.3-1.5秒
│   ├── Start Speed: 10-20
│   ├── Start Size: 0.5-2.0
│   ├── Shape: Sphere
│   ├── Emission Rate: 100-500
│   ├── Color: 橙色/红色
│   └── Auto Destroy: 开启
├── ParticleSystem (火花)
│   ├── Duration: 0.3-1.0秒
│   ├── Start Lifetime: 0.2-0.8秒
│   ├── Start Speed: 15-25
│   ├── Emission Rate: 50-200
│   └── Color: 黄色/白色
├── ParticleSystem (烟雾)
│   ├── Duration: 1.0-3.0秒
│   ├── Start Lifetime: 1.0-2.0秒
│   ├── Start Speed: 2-8
│   ├── Emission Rate: 20-100
│   └── Color: 灰色/黑色
└── AudioSource
    ├── AudioClip: 爆炸音效
    ├── Volume: 0.5-0.8
    └── Spatial Blend: 3D
```

### 3. 分离特效 (Detached)
```
Detached_Effects 设置规范：
├── Trail_Detached (分离尾迹)
│   ├── Trail Renderer
│   ├── Duration: 0.5-1.0秒
│   └── Auto Destroy: 开启
├── Spark_Detached (分离火花)
│   ├── ParticleSystem
│   ├── Duration: 0.3-0.8秒
│   └── Auto Destroy: 开启
└── Smoke_Detached (分离烟雾)
    ├── ParticleSystem
    ├── Duration: 1.0-2.0秒
    └── Auto Destroy: 开启
```

---

## 代码配置要求

### Bullet.cs 脚本配置
```csharp
// 必需在Inspector中设置的字段：
public float speed = 15f;                    // 子弹速度
public float hitOffset = 0f;                 // 碰撞偏移
public bool UseFirePointRotation;            // 使用发射点旋转
public Vector3 rotationOffset;               // 旋转偏移
public GameObject hit;                       // 碰撞爆炸特效预制体
public GameObject flash;                     // 发射闪光特效预制体
public GameObject[] Detached;                // 分离特效预制体数组

// 内部字段（由代码自动设置）：
private Rigidbody rb;                       // 刚体组件
private EffectData BulletDamageMsg;         // 伤害数据
private Vector3 TargetPos;                  // 目标位置
private Vector3 MoveVector;                 // 移动向量
```

### 特效预制体要求
1. **Flash特效**：必须包含ParticleSystem组件
2. **Hit特效**：必须包含ParticleSystem组件
3. **Detached特效**：作为子弹的子对象，碰撞后分离

---

## 性能优化规范

### 粒子系统优化设置
```
性能参数设置：
├── Max Particles: 100-500 (根据特效复杂度)
├── Auto Destroy: 开启
├── Use Auto Random Seed: 开启
├── Play On Awake: 开启
├── Stop Action: Destroy
└── Culling Mode: Always Simulate
```

### 内存管理
```
内存优化策略：
├── 对象池使用: UnityEngine.Pool
├── 自动销毁时间: 基于ParticleSystem.duration
├── 子弹生命周期: 2.0秒
├── 特效层级分离: 避免内存泄漏
└── LOD系统: 距离优化
```

### LOD设置规范
```
距离优化设置：
├── 近距离 (0-10米): 完整特效
│   ├── 高分辨率粒子
│   ├── 完整音效
│   └── 光源效果
├── 中距离 (10-30米): 简化特效
│   ├── 中等分辨率粒子
│   ├── 简化音效
│   └── 无光源
└── 远距离 (30米以上): 基础特效
    ├── 低分辨率粒子
    ├── 无音效
    └── 无光源
```

---

## 命名规范

### 文件命名规范
```
子弹预制体：
├── Bullet_[类型]_[名称].prefab
├── Bullet_Laser_Blue.prefab
├── Bullet_Plasma_Red.prefab
├── Bullet_Projectile_Green.prefab
└── Bullet_Energy_Yellow.prefab

特效预制体：
├── Effect_Flash_[类型].prefab
├── Effect_Hit_[类型].prefab
├── Effect_Detached_[类型].prefab
├── Effect_Flash_Laser.prefab
├── Effect_Hit_Explosion.prefab
└── Effect_Detached_Trail.prefab
```

### GameObject命名规范
```
子弹对象：
├── Bullet_[类型]
├── Bullet_Mesh
├── Bullet_Trail
├── Bullet_Collider
└── Bullet_Particles

特效对象：
├── Flash_Effect
├── Hit_Effect
├── Detached_Effect
├── Spark_Effect
└── Smoke_Effect
```

### 材质命名规范
```
材质命名：
├── Mat_[类型]_[效果]
├── Mat_Particle_Flash
├── Mat_Particle_Explosion
├── Mat_Trail_Bullet
└── Mat_Smoke_Effect
```

---

## 测试验证清单

### 功能测试
- [ ] 子弹正确移动
- [ ] 发射闪光正常播放
- [ ] 碰撞爆炸正确触发
- [ ] 分离特效正常分离
- [ ] 自动销毁正常工作
- [ ] 伤害系统正确传递
- [ ] 层级检测正常工作

### 性能测试
- [ ] 特效帧率稳定 (60FPS)
- [ ] 内存使用合理 (<100MB)
- [ ] 粒子数量控制 (<1000个)
- [ ] 音效同步正确
- [ ] 多子弹同时存在性能稳定

### 视觉测试
- [ ] 特效颜色符合设计
- [ ] 粒子大小适中
- [ ] 特效持续时间合理
- [ ] 光照效果正确
- [ ] 透明度设置正确

### 音效测试
- [ ] 发射音效同步
- [ ] 爆炸音效同步
- [ ] 音量设置合理
- [ ] 3D音效定位正确
- [ ] 音效不重叠

---

## 常见问题与解决方案

### 问题1：特效不播放
**原因**: ParticleSystem组件缺失或设置错误
**解决**: 检查特效预制体是否包含ParticleSystem组件

### 问题2：特效不自动销毁
**原因**: Auto Destroy未开启或Duration设置错误
**解决**: 确保ParticleSystem的Auto Destroy开启

### 问题3：碰撞检测失败
**原因**: 层级设置不匹配或Collider缺失
**解决**: 检查目标对象的Layer设置和碰撞体

### 问题4：性能问题
**原因**: 粒子数量过多或特效过于复杂
**解决**: 优化Max Particles设置，使用LOD系统

---

## 更新日志

### v1.0 (2024年)
- 初始版本
- 基于Bullet.cs代码逻辑
- 完整的特效制作规范
- 性能优化指南
- 测试验证清单

---

**文档维护**: 请根据项目需求定期更新此文档
**联系方式**: 如有问题请联系技术团队 